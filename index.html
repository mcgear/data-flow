<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <meta name="description" content="IoT projects to get you going in minutes, not weeks or months." />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" href="./static/css/app.css" />
    <script src="https://kit.fontawesome.com/0b7385f8de.js" crossorigin="anonymous"></script>

    <script type="module" src="./packages/es/index.js"></script>
</head>

<body>

    <header>
        <h2>Data Flow Tool</h2>
    </header>
  
      <div class="wrapper">
          <!-- 
              Left side menu items
           -->
        <div id="drag-items" class="col">
            
        </div>

        <div class="col-right">
          <div class="top-menu">
            <ul>
                <li 
                    onclick="flowTool.ChangeModule('Home'); 
                    menuTabSelected(event);" 
                    class="selected">
                    Home
                </li>
                <li 
                    onclick="flowTool.ChangeModule('Other'); 
                    menuTabSelected(event);">
                    Other Module
                </li>
            </ul>
          </div>

          <!-- Flow Tool -->
            <div 
                id="drawflow" 
                ondrop="drop(event)" 
                ondragover="allowDrop(event)">
            </div>

            <!-- <div class="btn-export" onclick="Swal.fire({ title: 'Export',
                html: '<pre><code>'+JSON.stringify(flowTool.export(), null,4)+'</code></pre>'
                })">Export</div>
            <div class="btn-clear" onclick="flowTool.clearModuleSelected()">Clear</div>
            <div class="btn-lock">
              <i id="lock" class="fas fa-lock" onclick="flowTool.editor_mode='fixed'; changeMode('lock');"></i>
              <i id="unlock" class="fas fa-lock-open" onclick="flowTool.editor_mode='edit'; changeMode('unlock');" style="display:none;"></i>
            </div>
            <div class="bar-zoom">
              <i class="fas fa-search-minus" onclick="flowTool.zoom_out()"></i>
              <i class="fas fa-search" onclick="flowTool.zoom_reset()"></i>
              <i class="fas fa-search-plus" onclick="flowTool.zoom_in()"></i>
            </div> -->
          </div>
        </div>
      </div>
      
    <!-- <script type="text/typescript">
       const typescriptCodeArray: Array<string>;
    </script> -->

   <script id="sjs-flow-tool" type="module">
        import { FlowTool, MenuTemplates, Variables, Events } from './packages/es/index.js';

        let id = document.getElementById("drawflow");
        let flowTool = new FlowTool(id);
        let events = new Events();
        let menuTemplates = [
            {
                ClassList: ['drag-drawflow'],
                DataNode: 'facebook',
                Draggable: true,
                DragAction: drag,
                Id: 'facebook',
                Label: ' Facebook',
                IconClassList: ['fab', 'fa-facebook']
            },
            {
                ClassList: ['drag-drawflow'],
                DataNode: 'slack',
                Draggable: true,
                DragAction: drag,
                Id: 'slack',
                Label: ' Slack receive messages',
                IconClassList: ['fab', 'fa-slack']
            },
            {
                ClassList: ['drag-drawflow'],
                DataNode: 'github',
                Draggable: true,
                DragAction: drag,
                Id: 'slack',
                Label: ' Github Star',
                IconClassList: ['fab', 'fa-github']
            },
            {
                ClassList: ['drag-drawflow'],
                DataNode: 'telegram',
                Draggable: true,
                DragAction: drag,
                Id: 'telegram',
                Label: ' Telegram send message',
                IconClassList: ['fab', 'fa-telegram']
            },
            {
                ClassList: ['drag-drawflow'],
                DataNode: 'aws',
                Draggable: true,
                DragAction: drag,
                Id: 'aws',
                Label: ' AWS',
                IconClassList: ['fab', 'fa-aws']
            },
            {
                ClassList: ['drag-drawflow'],
                DataNode: 'log',
                Draggable: true,
                DragAction: drag,
                Id: 'log',
                Label: ' File Log',
                IconClassList: ['fas', 'fa-file-signature']
            },
            {
                ClassList: ['drag-drawflow'],
                DataNode: 'google',
                Draggable: true,
                DragAction: drag,
                Id: 'google',
                Label: ' Google Drive save',
                IconClassList: ['fab', 'fa-google-drive']
            },
            {
                ClassList: ['drag-drawflow'],
                DataNode: 'email',
                Draggable: true,
                DragAction: drag,
                Id: 'email',
                Label: ' Email',
                IconClassList: ['fas', 'fa-at']
            },
            {
                ClassList: ['drag-drawflow'],
                DataNode: 'template',
                Draggable: true,
                DragAction: drag,
                Id: 'template',
                Label: ' Template',
                IconClassList: ['fas', 'fa-code']
            },
            {
                ClassList: ['drag-drawflow'],
                DataNode: 'multiple',
                Draggable: true,
                DragAction: drag,
                Id: 'multiple',
                Label: ' Multiple',
                IconClassList: ['fas', 'fa-code-branch']
            },
            {
                ClassList: ['drag-drawflow'],
                DataNode: 'personalized',
                Draggable: true,
                DragAction: drag,
                Id: 'personalized',
                Label: ' Personalized',
                IconClassList: ['fas', 'fa-fill']
            },
            {
                ClassList: ['drag-drawflow'],
                DataNode: 'dbclick',
                Draggable: true,
                DragAction: drag,
                Id: 'dbclick',
                Label: ' DBClick!',
                IconClassList: ['fas', 'fa-mouse']
            }
        ];

        MenuTemplates.Render(document.getElementById('drag-items'), menuTemplates);

        // Variables.reroute = true;
        // Variables.reroute_fix_curvature = true;
        // Variables.force_first_input = false;

        /**
         * Moduel data objects
        */
        const homeModuleData = {
            Module: 'Home',
            Data: {
                "1":
                {
                    "id":1,
                    "name":"welcome",
                    "data":{},
                    "class":"welcome",
                    "html":"\n    <div>\n      <div class=\"title-box\">üëè Welcome!!</div>\n      <div class=\"box\">\n        <p>Simple flow library <b>demo</b>\n        <a href=\"https://github.com/jerosoler/Drawflow\" target=\"_blank\">Drawflow</a> by <b>Jero Soler</b></p><br>\n\n        <p>Multiple input / outputs<br>\n           Data sync nodes<br>\n           Import / export<br>\n           Modules support<br>\n           Simple use<br>\n           Type: Fixed or Edit<br>\n           Events: view console<br>\n           Pure Javascript<br>\n        </p>\n        <br>\n        <p><b><u>Shortkeys:</u></b></p>\n        <p>üéπ <b>Delete</b> for remove selected<br>\n        üí† Mouse Left Click == Move<br>\n        ‚ùå Mouse Right == Delete Option<br>\n        üîç Ctrl + Wheel == Zoom<br>\n        üì± Mobile support<br>\n        ...</p>\n      </div>\n    </div>\n    ", 
                    "typenode": false, 
                    "inputs":{},
                    "outputs":{},
                    "pos_x":50,
                    "pos_y":50
                },
                "2":
                {
                    "id":2,
                    "name":"slack",
                    "data":{},
                    "class":"slack",
                    "html":"\n          <div>\n            <div class=\"title-box\"><i class=\"fab fa-slack\"></i> Slack chat message</div>\n          </div>\n          ", 
                    "typenode": false, 
                    "inputs":
                    {
                        "input_1":
                        {
                            "connections":
                            [
                                {"node":"7","input":"output_1"}
                            ]
                        }
                    },"outputs":{},
                    "pos_x":1028,
                    "pos_y":87
                },
                "3":
                {
                    "id":3,
                    "name":"telegram",
                    "data":
                    {
                        "channel":"channel_2"
                    },
                    "class":"telegram",
                    "html":"\n          <div>\n            <div class=\"title-box\"><i class=\"fab fa-telegram-plane\"></i> Telegram bot</div>\n            <div class=\"box\">\n              <p>Send to telegram</p>\n              <p>select channel</p>\n              <select df-channel>\n                <option value=\"channel_1\">Channel 1</option>\n                <option value=\"channel_2\">Channel 2</option>\n                <option value=\"channel_3\">Channel 3</option>\n                <option value=\"channel_4\">Channel 4</option>\n              </select>\n            </div>\n          </div>\n          ", 
                    "typenode": false, 
                    "inputs":
                    {
                        "input_1":
                        {
                            "connections":
                            [
                                {"node":"7","input":"output_1"}
                            ]
                        }
                    },
                    "outputs":{},
                    "pos_x":1032,
                    "pos_y":184
                    },
                    "4":
                    {
                        "id":4,
                        "name":"email",
                        "data":{},
                        "class":"email",
                        "html":"\n            <div>\n              <div class=\"title-box\"><i class=\"fas fa-at\"></i> Send Email </div>\n            </div>\n            ", 
                        "typenode": false, 
                        "inputs":
                        {
                            "input_1":
                            {
                                "connections":
                                [
                                    {"node":"5","input":"output_1"}
                                ]
                            }
                        },
                        "outputs":{},
                        "pos_x":1033,
                        "pos_y":439
                    },
                    "5":
                        {
                            "id":5,
                            "name":"template",
                            "data":
                            {
                                "template":"Write your template"
                            },
                            "class":"template",
                                "html":"\n            <div>\n              <div class=\"title-box\"><i class=\"fas fa-code\"></i> Template</div>\n              <div class=\"box\">\n                Ger Vars\n                <textarea df-template></textarea>\n                Output template with vars\n              </div>\n            </div>\n            ", 
                        "typenode": false, 
                        "inputs":
                        {
                            "input_1":
                            {
                                "connections":[
                                    {"node":"8","input":"output_1"}
                                ]
                            }
                        },
                        "outputs":
                        {
                            "output_1":
                            {
                                "connections":
                                [
                                    {"node":"4","output":"input_1"},
                                    { "node":"11","output":"input_1"}
                                ]
                            }
                        },
                        "pos_x":607,
                        "pos_y":304
                    },
                    "6":
                    {
                        "id":6,
                        "name":"github",
                        "data":
                        {
                            "name":"https://github.com/jerosoler/Drawflow"
                        },
                        "class":"github",
                        "html":"\n          <div>\n            <div class=\"title-box\"><i class=\"fab fa-github \"></i> Github Stars</div>\n            <div class=\"box\">\n              <p>Enter repository url</p>\n            <input type=\"text\" df-name>\n            </div>\n          </div>\n          ", 
                        "typenode": false, 
                        "inputs":{},
                        "outputs":
                        {
                            "output_1":
                            {
                                "connections":
                                [
                                    {"node":"5","output":"input_1"}
                                ]
                            }
                        },
                        "pos_x":341,
                        "pos_y":191
                    },
                    "7":
                    {
                        "id":7,
                        "name":"facebook",
                        "data":{},
                        "class":"facebook",
                        "html":"\n        <div>\n          <div class=\"title-box\"><i class=\"fab fa-facebook\"></i> Facebook Message</div>\n        </div>\n        ", 
                        "typenode": false, 
                        "inputs":{},
                        "outputs":
                        {
                            "output_1":
                            {
                                "connections":
                                [
                                    {"node":"2","output":"input_1"},
                                    {"node":"3","output":"input_1"},
                                    {"node":"11","output":"input_1"}
                                ]
                            }
                        },
                        "pos_x":347,
                        "pos_y":87},
                        "8":
                        {
                            "id":8,
                            "name":"diamondTest",
                            "data":{},
                            "class":"",
                            "html":"\n<div>\n<div>DDD</div>\n</div>\n", 
                            "typenode": false, 
                            "inputs":
                            {
                                "input_1":
                                {
                                    "connections":[{"node":"6","input":"output_1"}]
                                }
                            },
                            "outputs":
                            {
                                "output_1":
                            {
                                "connections":
                                [
                                    
                                ]
                            }
                            },
                            "pos_x":350,
                            "pos_y":450,
                            "shape": "diamond"
                        },
                        "9":
                        {
                            "id":9,
                            "name":"circleTest",
                            "data":{},
                            "class":"",
                            "html":"\n<div>\n<div>circle</div>\n</div>\n", 
                            "typenode": false, 
                            "inputs":{},
                            "outputs":{},
                            "pos_x":350,
                            "pos_y":550,
                            "shape": "circle"
                        },
                        "11":
                        {
                            "id":11,
                            "name":"log",
                            "data":{},
                            "class":"log",
                            "html":"\n            <div>\n              <div class=\"title-box\"><i class=\"fas fa-file-signature\"></i> Save log file </div>\n            </div>\n            ", 
                            "typenode": false, 
                            "inputs":
                            {
                                "input_1":
                                {
                                    "connections":
                                    [
                                        {"node":"5","input":"output_1"},
                                        {"node":"7","input":"output_1"}
                                    ]
                                }
                            },
                            "outputs":{},
                            "pos_x":1131,
                            "pos_y":600
                        }
                    }
            }    

        const otherModuleData = {
            Module: 'Other',
            Data:
                    {
                        "8":
                        {
                            "id": 8,
                            "name": "personalized",
                            "data": {},
                            "class": "personalized",
                            "html": "\n            <div>\n              Personalized\n            </div>\n            ",
                            "typenode": false,
                            "inputs":
                            {
                                "input_1":
                                {
                                    "connections":
                                        [
                                            { "node": "12", "input": "output_1" },
                                            { "node": "12", "input": "output_2" },
                                            { "node": "12", "input": "output_3" },
                                            { "node": "12", "input": "output_4" }
                                        ]
                                }
                            },
                            "outputs":
                            {
                                "output_1":
                                {
                                    "connections":
                                        [
                                            { "node": "9", "output": "input_1" }
                                        ]
                                }
                            },
                            "pos_x": 764,
                            "pos_y": 227
                        },
                        "9":
                        {
                            "id": 9,
                            "name": "dbclick",
                            "data":
                            {
                                "name": "Hello World!!"
                            },
                            "class": "dbclick",
                            "html": "\n            <div>\n            <div class=\"title-box\"><i class=\"fas fa-mouse\"></i> Db Click</div>\n              <div class=\"box dbclickbox\" ondblclick=\"showpopup(event)\">\n                Db Click here\n                <div class=\"modal\" style=\"display:none\">\n                  <div class=\"modal-content\">\n                    <span class=\"close\" onclick=\"closemodal(event)\">&times;</span>\n                    Change your variable {name} !\n                    <input type=\"text\" df-name>\n                  </div>\n\n                </div>\n              </div>\n            </div>\n            ",
                            "typenode": false,
                            "inputs":
                            {
                                "input_1":
                                {
                                    "connections":
                                        [
                                            { "node": "8", "input": "output_1" }
                                        ]
                                }
                            }, "outputs":
                            {
                                "output_1":
                                {
                                    "connections":
                                        [
                                            { "node": "12", "output": "input_2" }
                                        ]
                                }
                            },
                            "pos_x": 209,
                            "pos_y": 38
                        },
                        "12":
                        {
                            "id": 12,
                            "name": "multiple",
                            "data": {},
                            "class": "multiple",
                            "html": "\n            <div>\n              <div class=\"box\">\n                Multiple!\n              </div>\n            </div>\n            ",
                            "typenode": false,
                            "inputs":
                            {
                                "input_1":
                                {
                                    "connections": []
                                },
                                "input_2":
                                {
                                    "connections":
                                        [
                                            { "node": "9", "input": "output_1" }
                                        ]
                                },
                                "input_3": {
                                    "connections": []
                                }
                            },
                            "outputs":
                            {
                                "output_1":
                                {
                                    "connections":
                                        [
                                            { "node": "8", "output": "input_1" }
                                        ]
                                }, "output_2":
                                {
                                    "connections":
                                        [
                                            { "node": "8", "output": "input_1" }
                                        ]
                                },
                                "output_3":
                                {
                                    "connections":
                                        [
                                            { "node": "8", "output": "input_1" }
                                        ]
                                },
                                "output_4":
                                {
                                    "connections":
                                        [
                                            { "node": "8", "output": "input_1" }
                                        ]
                                }
                            },
                            "pos_x": 179,
                            "pos_y": 272
                        }
                    }
        }

        /**
         * Array for storing module data
        */
        Variables.DataFlowModuleData = 
        [
            homeModuleData,
            otherModuleData
        ]
     
        flowTool.Start();
        flowTool.ImportData(Variables.DataFlowModuleData[0]);
        

    // Events!

    // { Event: 'mouseMove', Callback: (val) => 
    //     { 
    //         console.log('Mouse X ' + val.x + ' : ' + 'Mouse Y ' + val.y)
    //     }  
    // }

    const flowDispatchedEvents = [
        { Event: 'mouseMove', Message: 'Mouse position', Params: ['x','y'] },
        { Event: 'nodeMoved', Message: 'Node moved' },
        { Event: 'nodeCreated', Message: 'Node created' },
        { Event: 'nodeRemoved', Message: 'Node removed' },
        { Event: 'nodeSelected', Message: 'Node selected' },
        { Event: 'moduleCreated', Message: 'Module created' },
        { Event: 'moduleChanged', Message: 'Module Changed' },
        { Event: 'connectionCreated', Message: 'Connection created' },
        { Event: 'zoom', Message: 'Zoom' },
        { Event: 'translate', Message: 'Translate' },
        { Event: 'addReroute', Message: 'Add reroute' },
        { Event: 'removeReroute', Message: 'Remove reroute' }
    ]

     /**
     * Events that are dispatched from base-functions.Dispatch
    */
    for (const e of flowDispatchedEvents) {
        // events.OnEvent(e.Event, e.Callback);
        events.OnEvent(e.Event, (val) => {

                if (e.Params && e.Params.length > 0) {
                    for (const v of e.Params) {
                        console.log(e.Message + ' ' + v + ': ' + val[v]);
                    }
                } else {
                    console.log(e.Message + ' ' + val);
            }
        })
    }

    /* DRAG EVENT */

    /* Mouse and Touch Actions */

    const elements = document.getElementsByClassName('drag-drawflow');
   
    for (var i = 0; i < elements.length; i++) {
        elements[i].addEventListener('touchend', drop, false);
        elements[i].addEventListener('touchmove', positionMobile, false);
        elements[i].addEventListener('touchstart', drag, false );
    }

    // document.querySelector('#hello').addEventListener('touchstart', drag, false);
    // console.log("DRAG DIV ", document.querySelector('#hello'));

    let mobile_item_selec = '';
    let mobile_last_move = null;

   function positionMobile(ev) {
     mobile_last_move = ev;
   }

   function allowDrop(ev) {
      ev.preventDefault();
    }

    /**
     * When dragging an item from the side menu onto the canvas 
     **/
   function drag(ev) {
      if (ev.type === "touchstart") {
        mobile_item_selec = ev.target.closest(".drag-drawflow").getAttribute('data-node');
      } else {
      ev.dataTransfer.setData("node", ev.target.getAttribute('data-node'));
      }
    }

    function drop(ev) {
      if (ev.type === "touchend") {
        var parentdrawflow = document.elementFromPoint( mobile_last_move.touches[0].clientX, mobile_last_move.touches[0].clientY).closest("#drawflow");
        if(parentdrawflow != null) {
          addNodeToDrawFlow(mobile_item_selec, mobile_last_move.touches[0].clientX, mobile_last_move.touches[0].clientY);
        }
        mobile_item_selec = '';
      } else {
        ev.preventDefault();
        var data = ev.dataTransfer.getData("node");
        addNodeToDrawFlow(data, ev.clientX, ev.clientY);
      }

    }

    function addNodeToDrawFlow(name, pos_x, pos_y) {
      if(flowTool.editor_mode === 'fixed') {
        return false;
      }
      pos_x = pos_x * ( Variables.precanvas.clientWidth / (Variables.precanvas.clientWidth * Variables.zoom)) - (Variables.precanvas.getBoundingClientRect().x * ( Variables.precanvas.clientWidth / (Variables.precanvas.clientWidth * Variables.zoom)));
      pos_y = pos_y * ( Variables.precanvas.clientHeight / (Variables.precanvas.clientHeight * Variables.zoom)) - (Variables.precanvas.getBoundingClientRect().y * ( Variables.precanvas.clientHeight / (Variables.precanvas.clientHeight * Variables.zoom)));


      switch (name) {
        case 'facebook':
        var facebook = `
        <div>
          <div class="title-box"><i class="fab fa-facebook"></i> Facebook Message</div>
        </div>
        `;
        flowTool.AddNode('facebook', 0,  1, pos_x, pos_y, 'facebook', {}, facebook );
          break;
        case 'slack':
          var slackchat = `
          <div>
            <div class="title-box"><i class="fab fa-slack"></i> Slack chat message</div>
          </div>
          `
          flowTool.AddNode('slack', 1, 0, pos_x, pos_y, 'slack', {}, slackchat );
          break;
        case 'github':
          var githubtemplate = `
          <div>
            <div class="title-box"><i class="fab fa-github "></i> Github Stars</div>
            <div class="box">
              <p>Enter repository url</p>
            <input type="text" df-name>
            </div>
          </div>
          `;
          flowTool.AddNode('github', 0, 1, pos_x, pos_y, 'github', { "name": ''}, githubtemplate );
          break;
        case 'telegram':
          var telegrambot = `
          <div>
            <div class="title-box"><i class="fab fa-telegram-plane"></i> Telegram bot</div>
            <div class="box">
              <p>Send to telegram</p>
              <p>select channel</p>
              <select df-channel>
                <option value="channel_1">Channel 1</option>
                <option value="channel_2">Channel 2</option>
                <option value="channel_3">Channel 3</option>
                <option value="channel_4">Channel 4</option>
              </select>
            </div>
          </div>
          `;
          flowTool.AddNode('telegram', 1, 0, pos_x, pos_y, 'telegram', { "channel": 'channel_3'}, telegrambot );
          break;
        case 'aws':
          var aws = `
          <div>
            <div class="title-box"><i class="fab fa-aws"></i> Aws Save </div>
            <div class="box">
              <p>Save in aws</p>
              <input type="text" df-db-dbname placeholder="DB name"><br><br>
              <input type="text" df-db-key placeholder="DB key">
              <p>Output Log</p>
            </div>
          </div>
          `;
          flowTool.AddNode('aws', 1, 1, pos_x, pos_y, 'aws', { "db": { "dbname": '', "key": '' }}, aws );
          break;
        case 'log':
            var log = `
            <div>
              <div class="title-box"><i class="fas fa-file-signature"></i> Save log file </div>
            </div>
            `;
            flowTool.AddNode('log', 1, 0, pos_x, pos_y, 'log', {}, log );
            break;
          case 'google':
            var google = `
            <div>
              <div class="title-box"><i class="fab fa-google-drive"></i> Google Drive save </div>
            </div>
            `;
            flowTool.AddNode('google', 1, 0, pos_x, pos_y, 'google', {}, google );
            break;
          case 'email':
            var email = `
            <div>
              <div class="title-box"><i class="fas fa-at"></i> Send Email </div>
            </div>
            `;
            flowTool.AddNode('email', 1, 0, pos_x, pos_y, 'email', {}, email );
            break;

          case 'template':
            var template = `
            <div>
              <div class="title-box"><i class="fas fa-code"></i> Template</div>
              <div class="box">
                Ger Vars
                <textarea df-template></textarea>
                Output template with vars
              </div>
            </div>
            `;
            flowTool.AddNode('template', 1, 1, pos_x, pos_y, 'template', { "template": 'Write your template'}, template );
            break;
          case 'multiple':
            var multiple = `
            <div>
              <div class="box">
                Multiple!
              </div>
            </div>
            `;
            flowTool.AddNode('multiple', 3, 4, pos_x, pos_y, 'multiple', {}, multiple );
            break;
          case 'personalized':
            var personalized = `
            <div>
              Personalized
            </div>
            `;
            flowTool.AddNode('personalized', 1, 1, pos_x, pos_y, 'personalized', {}, personalized );
            break;
          case 'dbclick':
            var dbclick = `
            <div>
            <div class="title-box"><i class="fas fa-mouse"></i> Db Click</div>
              <div class="box dbclickbox" ondblclick="showpopup(event)">
                Db Click here
                <div class="modal" style="display:none">
                  <div class="modal-content">
                    <span class="close" onclick="closemodal(event)">&times;</span>
                    Change your variable {name} !
                    <input type="text" df-name>
                  </div>

                </div>
              </div>
            </div>
            `;
            flowTool.AddNode('dbclick', 1, 1, pos_x, pos_y, 'dbclick', { name: ''}, dbclick );
            break;

        default:
      }
    }

  var transform = '';
  function showpopup(e) {
    e.target.closest(".drawflow-node").style.zIndex = "9999";
    e.target.children[0].style.display = "block";
    //document.getElementById("modalfix").style.display = "block";

    //e.target.children[0].style.transform = 'translate('+translate.x+'px, '+translate.y+'px)';
    transform = flowTool.precanvas.style.transform;
    flowTool.precanvas.style.transform = '';
    flowTool.precanvas.style.left = flowTool.canvas_x +'px';
    flowTool.precanvas.style.top = flowTool.canvas_y +'px';
    console.log(transform);

    //e.target.children[0].style.top  =  -flowTool.canvas_y - flowTool.container.offsetTop +'px';
    //e.target.children[0].style.left  =  -flowTool.canvas_x  - flowTool.container.offsetLeft +'px';
    flowTool.editor_mode = "fixed";

  }

   function closemodal(e) {
     e.target.closest(".drawflow-node").style.zIndex = "2";
     e.target.parentElement.parentElement.style.display  ="none";
     //document.getElementById("modalfix").style.display = "none";
     flowTool.precanvas.style.transform = transform;
     flowTool.precanvas.style.left = '0px';
     flowTool.precanvas.style.top = '0px';
     flowTool.editor_mode = "edit";
   }

   /**
    * Add / remove styles on menu tab click
    **/
    function menuTabSelected(event) {
      var all = document.querySelectorAll(".top-menu ul li");
        for (var i = 0; i < all.length; i++) {
          all[i].classList.remove('selected');
        }
      event.target.classList.add('selected');
    }

    function changeMode(option) {

    //console.log(lock.id);
      if(option == 'lock') {
        lock.style.display = 'none';
        unlock.style.display = 'block';
      } else {
        lock.style.display = 'block';
        unlock.style.display = 'none';
      }
    }

    /**
     * Need to create global properties, so we 
     * have access to variables from within
     **/
        window.allowDrop = allowDrop;
        window.drop = drop;
        window.flowTool = flowTool;
        window.menuTabSelected = menuTabSelected;
    </script>



    <!-- <style>
        .connection.github.output_1 path {
            stroke: red;
        }

        .connection.github.output_2 path {
            stroke: green;
        }
   </style> -->
    <!-- <script type="text/javascript" src="./typescript-compiler/typescript.min.js"></script>
    <script type="text/javascript" src="./typescript-compiler/typescript.compile.min.js"></script> -->
</body>
</html>